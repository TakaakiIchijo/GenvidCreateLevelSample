job "unity" {
  datacenters = [
	# {{range $i, $dc := datacenters}}
	"{{$dc}}",
	# {{end}}
  ]

  task "unity" {
    driver = "raw_exec"

    config {
      command = "{{key `local/unity/appdir` | js}}\\Build\\GenvidEventMakeStageSample.exe"
      args = [
		"-force-d3d11",
		"-logFile",
		"${NOMAD_ALLOC_DIR}/logs/unity.log",
		"-screen-height",
		"{{- keyOrDefault `genvid/encode/input/height` `720` -}}",
		"-screen-width",
		"{{- keyOrDefault `genvid/encode/input/width` `1280` -}}",
      ]
    }

	resources {
		network {
			port "sdkgui" {}
		}
	}

	service {
		name = "sdkguiservice"
		port = "sdkgui"
	}

    env {
	  CONSUL_HTTP_ADDR = "{{ print (env `GENVID_DEFAULT_IP`) `:8500` }}"
      GLOG_logtostderr = "1"
	  GENVID_LOGGER_PREFIX = "unity"
    }
  }
}
